<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlashCard Fun! üéØ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'Chalkboard', cursive;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            font-size: 2.5em;
            text-shadow: 3px 3px 0 #ff6b6b, 6px 6px 0 #4ecdc4;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes celebrate {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-5deg); }
            50% { transform: scale(1.2) rotate(5deg); }
            75% { transform: scale(1.1) rotate(-5deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .upload-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }

        .upload-section h2 {
            color: #764ba2;
            margin-bottom: 20px;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: scale(1.05);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-orange {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            margin: 10px;
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }

        .quiz-section {
            display: block;
        }

        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
        }

        .correct { color: #38ef7d; }
        .incorrect { color: #f5576c; }
        .remaining { color: #667eea; }

        .flashcard {
            background: white;
            border-radius: 20px;
            padding: 40px;
            min-height: 250px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .flashcard::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 10px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7, #dfe6e9, #ff6b6b);
            background-size: 200% 100%;
            animation: rainbow 3s linear infinite;
        }

        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        .question-label {
            color: #764ba2;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 2em;
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }

        .answer-input {
            width: 100%;
            max-width: 400px;
            padding: 15px 20px;
            font-size: 1.3em;
            border: 3px solid #ddd;
            border-radius: 50px;
            text-align: center;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        .answer-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 1.3em;
            display: none;
        }

        .feedback.correct {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            animation: celebrate 0.5s ease;
        }

        .feedback.incorrect {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            animation: shake 0.5s ease;
        }

        .controls {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #38ef7d, #11998e);
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .results-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .results-section h2 {
            color: #764ba2;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .trophy {
            font-size: 5em;
            margin-bottom: 20px;
            animation: bounce 1s infinite;
        }

        .score-display {
            font-size: 3em;
            color: #38ef7d;
            margin-bottom: 20px;
        }

        .missed-list {
            text-align: left;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .missed-item {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }

        .missed-item:last-child {
            border-bottom: none;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #f00;
            animation: fall 3s linear forwards;
            pointer-events: none;
        }

        @keyframes fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        .instructions {
            background: #fff3cd;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            text-align: left;
        }

        .instructions h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .instructions p, .instructions li {
            color: #856404;
            line-height: 1.6;
        }

        .mode-toggle {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }

        .mode-toggle h3 {
            color: #764ba2;
            margin-bottom: 15px;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>FlashCard Fun! üéØ</h1>

        <!-- Upload Section -->
        <div class="upload-section" id="uploadSection">
            <h2>üìö Let's Get Started!</h2>
            <p style="margin-bottom: 20px; color: #666;">Upload a CSV file with your flashcards or download our template first!</p>

            <div>
                <button class="btn btn-info" onclick="downloadTemplate()">
                    üì• Download Template
                </button>
                <div class="file-input-wrapper">
                    <button class="btn btn-primary">üìÅ Upload CSV File</button>
                    <input type="file" id="csvFile" accept=".csv" onchange="handleFileUpload(event)">
                </div>
            </div>

            <div class="instructions">
                <h3>üìù How to use:</h3>
                <ol>
                    <li>Download the template CSV file</li>
                    <li>Open it in Excel or Google Sheets</li>
                    <li>Add your questions in the first column and answers in the second column</li>
                    <li>Save as CSV and upload it here</li>
                    <li>Start quizzing your students!</li>
                </ol>
            </div>
        </div>

        <!-- Mode Selection -->
        <div class="mode-toggle hidden" id="modeSection">
            <h3>üéÆ Choose Your Mode</h3>
            <button class="btn btn-success" onclick="startQuiz('all')">
                üìù Quiz All Cards
            </button>
            <button class="btn btn-warning" onclick="startQuiz('missed')" id="missedBtn">
                üîÑ Practice Missed Only
            </button>
            <button class="btn btn-info" onclick="resetAndUpload()">
                üìÅ Upload New Cards
            </button>
        </div>

        <!-- Quiz Section -->
        <div class="quiz-section hidden" id="quizSection">
            <div class="stats-bar">
                <div class="stat">
                    <div class="stat-number correct" id="correctCount">0</div>
                    <div class="stat-label">‚úÖ Correct</div>
                </div>
                <div class="stat">
                    <div class="stat-number incorrect" id="incorrectCount">0</div>
                    <div class="stat-label">‚ùå Incorrect</div>
                </div>
                <div class="stat">
                    <div class="stat-number remaining" id="remainingCount">0</div>
                    <div class="stat-label">üìö Remaining</div>
                </div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>

            <div class="flashcard">
                <div class="question-label">‚ùì Question:</div>
                <div class="question-text" id="questionText">Loading...</div>
                <input type="text" class="answer-input" id="answerInput" placeholder="Type your answer..." onkeypress="handleKeyPress(event)">
                <div class="feedback" id="feedback"></div>
            </div>

            <div class="controls">
                <button class="btn btn-success" onclick="checkAnswer()" id="checkBtn">
                    ‚úîÔ∏è Check Answer
                </button>
                <button class="btn btn-primary hidden" onclick="nextCard()" id="nextBtn">
                    ‚û°Ô∏è Next Card
                </button>
                <button class="btn btn-warning" onclick="showAnswer()" id="showBtn">
                    üëÄ Show Answer
                </button>
                <button class="btn btn-orange" onclick="endQuiz()">
                    üè† Back to Menu
                </button>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-section hidden" id="resultsSection">
            <div class="trophy">üèÜ</div>
            <h2>Quiz Complete!</h2>
            <div class="score-display" id="scoreDisplay">0%</div>
            <p id="resultMessage" style="font-size: 1.3em; color: #666; margin-bottom: 20px;"></p>

            <div id="missedSection" class="hidden">
                <h3 style="color: #f5576c; margin-bottom: 10px;">üìù Questions to Practice:</h3>
                <div class="missed-list" id="missedList"></div>
            </div>

            <div class="controls" style="margin-top: 20px;">
                <button class="btn btn-success" onclick="startQuiz('all')">
                    üîÑ Quiz All Again
                </button>
                <button class="btn btn-warning" onclick="startQuiz('missed')" id="retryMissedBtn">
                    üìù Practice Missed
                </button>
                <button class="btn btn-info" onclick="goToMenu()">
                    üè† Back to Menu
                </button>
            </div>
        </div>
    </div>

    <script>
        // App State
        let flashcards = [];
        let currentCards = [];
        let currentIndex = 0;
        let correctCount = 0;
        let incorrectCount = 0;
        let missedCards = [];
        let allMissedCards = []; // Tracks all missed cards across sessions
        let answered = false;

        // Template CSV content
        const templateCSV = `term,definition
What is the capital of France?,Paris
What is 7 x 8?,56
What planet is known as the Red Planet?,Mars
What is the largest ocean?,Pacific Ocean
How many continents are there?,7
What is H2O commonly known as?,Water
Who wrote "Charlotte's Web"?,E.B. White
What is the fastest land animal?,Cheetah
How many sides does a hexagon have?,6
What color do you get when you mix red and blue?,Purple`;

        // Download template
        function downloadTemplate() {
            const blob = new Blob([templateCSV], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'flashcard_template.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Parse CSV
        function parseCSV(text) {
            const lines = text.trim().split('\n');
            const cards = [];

            // Skip header row
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                // Handle quoted values with commas
                let term, definition;
                if (line.includes('"')) {
                    const matches = line.match(/("([^"]*)"|[^,]+)/g);
                    if (matches && matches.length >= 2) {
                        term = matches[0].replace(/^"|"$/g, '').trim();
                        definition = matches[1].replace(/^"|"$/g, '').trim();
                    }
                } else {
                    const parts = line.split(',');
                    if (parts.length >= 2) {
                        term = parts[0].trim();
                        definition = parts.slice(1).join(',').trim();
                    }
                }

                if (term && definition) {
                    cards.push({ term, definition });
                }
            }
            return cards;
        }

        // Handle file upload
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                flashcards = parseCSV(e.target.result);
                if (flashcards.length > 0) {
                    allMissedCards = [];
                    showModeSection();
                } else {
                    alert('No valid flashcards found in the file. Please check the format!');
                }
            };
            reader.readAsText(file);
        }

        // Show mode selection
        function showModeSection() {
            document.getElementById('uploadSection').classList.add('hidden');
            document.getElementById('modeSection').classList.remove('hidden');
            document.getElementById('quizSection').classList.add('hidden');
            document.getElementById('resultsSection').classList.add('hidden');
            updateMissedButton();
        }

        // Update missed button state
        function updateMissedButton() {
            const missedBtn = document.getElementById('missedBtn');
            if (allMissedCards.length === 0) {
                missedBtn.disabled = true;
                missedBtn.style.opacity = '0.5';
                missedBtn.title = 'No missed cards yet!';
            } else {
                missedBtn.disabled = false;
                missedBtn.style.opacity = '1';
                missedBtn.title = `${allMissedCards.length} cards to practice`;
            }
        }

        // Start quiz
        function startQuiz(mode) {
            if (mode === 'missed') {
                if (allMissedCards.length === 0) {
                    alert('No missed cards to practice! Try quizzing all cards first.');
                    return;
                }
                currentCards = [...allMissedCards];
            } else {
                currentCards = [...flashcards];
            }

            // Shuffle cards
            shuffleArray(currentCards);

            currentIndex = 0;
            correctCount = 0;
            incorrectCount = 0;
            missedCards = [];
            answered = false;

            document.getElementById('modeSection').classList.add('hidden');
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('quizSection').classList.remove('hidden');

            updateStats();
            showCard();
        }

        // Shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Show current card
        function showCard() {
            if (currentIndex >= currentCards.length) {
                showResults();
                return;
            }

            const card = currentCards[currentIndex];
            document.getElementById('questionText').textContent = card.term;
            document.getElementById('answerInput').value = '';
            document.getElementById('answerInput').focus();
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('checkBtn').classList.remove('hidden');
            document.getElementById('showBtn').classList.remove('hidden');
            document.getElementById('nextBtn').classList.add('hidden');
            answered = false;

            updateStats();
        }

        // Update statistics display
        function updateStats() {
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('incorrectCount').textContent = incorrectCount;
            document.getElementById('remainingCount').textContent = currentCards.length - currentIndex;

            const progress = currentCards.length > 0 ? (currentIndex / currentCards.length) * 100 : 0;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        // Check answer
        function checkAnswer() {
            if (answered) return;

            const userAnswer = document.getElementById('answerInput').value.trim().toLowerCase();
            const correctAnswer = currentCards[currentIndex].definition.toLowerCase();
            const feedback = document.getElementById('feedback');

            answered = true;

            if (userAnswer === correctAnswer) {
                correctCount++;
                feedback.textContent = 'üéâ Correct! Great job!';
                feedback.className = 'feedback correct';
                createConfetti();
            } else {
                incorrectCount++;
                feedback.textContent = `‚ùå Not quite! The answer is: ${currentCards[currentIndex].definition}`;
                feedback.className = 'feedback incorrect';

                // Add to missed cards if not already there
                const card = currentCards[currentIndex];
                if (!missedCards.some(c => c.term === card.term)) {
                    missedCards.push(card);
                }
            }

            feedback.style.display = 'block';
            document.getElementById('checkBtn').classList.add('hidden');
            document.getElementById('showBtn').classList.add('hidden');
            document.getElementById('nextBtn').classList.remove('hidden');

            updateStats();
        }

        // Show answer (counts as incorrect)
        function showAnswer() {
            if (answered) return;

            const feedback = document.getElementById('feedback');
            answered = true;
            incorrectCount++;

            feedback.textContent = `üëÄ The answer is: ${currentCards[currentIndex].definition}`;
            feedback.className = 'feedback incorrect';
            feedback.style.display = 'block';

            // Add to missed cards
            const card = currentCards[currentIndex];
            if (!missedCards.some(c => c.term === card.term)) {
                missedCards.push(card);
            }

            document.getElementById('checkBtn').classList.add('hidden');
            document.getElementById('showBtn').classList.add('hidden');
            document.getElementById('nextBtn').classList.remove('hidden');

            updateStats();
        }

        // Handle Enter key
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                if (answered) {
                    nextCard();
                } else {
                    checkAnswer();
                }
            }
        }

        // Next card
        function nextCard() {
            currentIndex++;
            showCard();
        }

        // Show results
        function showResults() {
            document.getElementById('quizSection').classList.add('hidden');
            document.getElementById('resultsSection').classList.remove('hidden');

            const total = correctCount + incorrectCount;
            const percentage = total > 0 ? Math.round((correctCount / total) * 100) : 0;

            document.getElementById('scoreDisplay').textContent = `${percentage}%`;

            let message = '';
            if (percentage === 100) {
                message = 'üåü PERFECT SCORE! You are a superstar! üåü';
                createConfetti();
                createConfetti();
                createConfetti();
            } else if (percentage >= 80) {
                message = 'üòÑ Awesome job! Almost perfect!';
                createConfetti();
            } else if (percentage >= 60) {
                message = 'üëç Good effort! Keep practicing!';
            } else {
                message = 'üí™ Don\'t give up! Practice makes perfect!';
            }

            document.getElementById('resultMessage').textContent = message;

            // Update all missed cards
            missedCards.forEach(card => {
                if (!allMissedCards.some(c => c.term === card.term)) {
                    allMissedCards.push(card);
                }
            });

            // Remove cards that were answered correctly from allMissedCards
            allMissedCards = allMissedCards.filter(card => {
                return missedCards.some(m => m.term === card.term);
            });

            // Show missed cards section
            const missedSection = document.getElementById('missedSection');
            const missedList = document.getElementById('missedList');
            const retryBtn = document.getElementById('retryMissedBtn');

            if (missedCards.length > 0) {
                missedSection.classList.remove('hidden');
                missedList.innerHTML = missedCards.map(card =>
                    `<div class="missed-item"><strong>Q:</strong> ${card.term}<br><strong>A:</strong> ${card.definition}</div>`
                ).join('');
                retryBtn.classList.remove('hidden');
            } else {
                missedSection.classList.add('hidden');
                retryBtn.classList.add('hidden');
            }
        }

        // Create confetti effect
        function createConfetti() {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#dfe6e9', '#a29bfe', '#fd79a8'];

            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    document.body.appendChild(confetti);

                    setTimeout(() => confetti.remove(), 4000);
                }, i * 30);
            }
        }

        // Go back to menu
        function goToMenu() {
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('quizSection').classList.add('hidden');
            showModeSection();
        }

        // End quiz early
        function endQuiz() {
            if (confirm('Are you sure you want to end the quiz?')) {
                document.getElementById('quizSection').classList.add('hidden');
                showModeSection();
            }
        }

        // Reset and upload new cards
        function resetAndUpload() {
            flashcards = [];
            currentCards = [];
            allMissedCards = [];
            document.getElementById('csvFile').value = '';
            document.getElementById('modeSection').classList.add('hidden');
            document.getElementById('uploadSection').classList.remove('hidden');
        }
    </script>
</body>
</html>
