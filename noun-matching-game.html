<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noun Match Adventure!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 30px;
            padding: 40px;
            max-width: 1200px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            font-size: 3.5rem;
            text-align: center;
            color: #4a4a8a;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        h2 {
            font-size: 2rem;
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        .subtitle {
            font-size: 1.5rem;
            text-align: center;
            color: #888;
            margin-bottom: 40px;
        }

        /* Screens */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* Buttons */
        .btn {
            font-size: 1.8rem;
            padding: 20px 50px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            margin: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(245, 87, 108, 0.4);
        }

        .btn-hint {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            font-size: 1.4rem;
            padding: 15px 30px;
        }

        .btn-hint:hover {
            transform: scale(1.05);
        }

        .btn-hint:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* Difficulty Selection */
        .difficulty-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin: 40px 0;
        }

        .difficulty-btn {
            font-size: 1.6rem;
            padding: 30px 50px;
            border: 4px solid transparent;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }

        .difficulty-btn.easy {
            background: #d4edda;
            color: #155724;
            border-color: #28a745;
        }

        .difficulty-btn.medium {
            background: #fff3cd;
            color: #856404;
            border-color: #ffc107;
        }

        .difficulty-btn.hard {
            background: #f8d7da;
            color: #721c24;
            border-color: #dc3545;
        }

        .difficulty-btn:hover {
            transform: scale(1.08);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .difficulty-desc {
            font-size: 1.1rem;
            margin-top: 10px;
            opacity: 0.8;
        }

        /* Game Area */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .score-display, .progress-display, .hints-display {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4a4a8a;
            background: #f0f0ff;
            padding: 15px 25px;
            border-radius: 15px;
        }

        .score-display span, .hints-display span {
            color: #667eea;
        }

        /* Category Boxes */
        .categories-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .category-box {
            min-width: 280px;
            min-height: 200px;
            border: 5px dashed #ccc;
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .category-box.person {
            background: #e3f2fd;
            border-color: #2196f3;
        }

        .category-box.place {
            background: #e8f5e9;
            border-color: #4caf50;
        }

        .category-box.thing {
            background: #fff3e0;
            border-color: #ff9800;
        }

        .category-box.drag-over {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .category-title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .category-box.person .category-title { color: #1565c0; }
        .category-box.place .category-title { color: #2e7d32; }
        .category-box.thing .category-title { color: #ef6c00; }

        .category-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .dropped-words {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            min-height: 50px;
        }

        .dropped-word {
            font-size: 1.3rem;
            padding: 8px 15px;
            border-radius: 10px;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* Word Cards */
        .words-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }

        .word-card {
            font-size: 1.8rem;
            padding: 20px 35px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            cursor: grab;
            transition: all 0.3s ease;
            user-select: none;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .word-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .word-card.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .word-card.correct {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            animation: correctPulse 0.5s ease;
        }

        .word-card.incorrect {
            background: linear-gradient(135deg, #cb2d3e 0%, #ef473a 100%);
            animation: shake 0.5s ease;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Hint Display */
        .hint-box {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            font-size: 1.5rem;
            text-align: center;
            margin: 20px auto;
            max-width: 600px;
            display: none;
        }

        .hint-box.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Instructions */
        .instructions {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            font-size: 1.4rem;
            line-height: 1.8;
        }

        .instructions h3 {
            font-size: 1.8rem;
            color: #4a4a8a;
            margin-bottom: 15px;
        }

        .instructions ul {
            margin-left: 30px;
        }

        .instructions li {
            margin: 10px 0;
        }

        /* Results Screen */
        .results-container {
            text-align: center;
        }

        .final-score {
            font-size: 4rem;
            color: #667eea;
            margin: 30px 0;
        }

        .score-message {
            font-size: 2rem;
            color: #666;
            margin-bottom: 30px;
        }

        .stars {
            font-size: 4rem;
            margin: 20px 0;
        }

        /* Feedback Messages */
        .feedback {
            font-size: 2rem;
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            display: none;
        }

        .feedback.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
        }

        /* Button Container */
        .button-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 30px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 { font-size: 2.5rem; }
            h2 { font-size: 1.5rem; }
            .btn { font-size: 1.4rem; padding: 15px 30px; }
            .word-card { font-size: 1.4rem; padding: 15px 25px; }
            .category-box { min-width: 200px; min-height: 150px; }
        }

        /* Class mode indicator */
        .class-mode {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 20px;
        }

        /* Teacher Upload Section */
        .teacher-section {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
            border: 3px dashed #667eea;
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
            text-align: center;
        }

        .teacher-section h3 {
            color: #4a4a8a;
            font-size: 1.6rem;
            margin-bottom: 15px;
        }

        .teacher-section p {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }

        .upload-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }

        .btn-upload {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
        }

        .btn-upload:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-template {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn-template:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(56, 239, 125, 0.4);
        }

        .btn-clear {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
        }

        .btn-clear:hover {
            transform: scale(1.05);
        }

        .upload-status {
            padding: 15px 25px;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            margin-top: 10px;
            display: none;
        }

        .upload-status.success {
            display: block;
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }

        .upload-status.error {
            display: block;
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .custom-words-badge {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: bold;
            display: none;
            margin-bottom: 15px;
        }

        .custom-words-badge.show {
            display: inline-block;
        }

        .upload-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

    </style>
</head>
<body>
    <div class="container">
        <!-- Welcome Screen -->
        <div id="welcome-screen" class="screen active">
            <h1>üéØ Noun Match Adventure!</h1>
            <p class="subtitle">Learn about People, Places, and Things!</p>
            
            <div class="instructions">
                <h3>üìö How to Play:</h3>
                <ul>
                    <li><strong>Drag</strong> each word card to the correct category box</li>
                    <li><strong>Person</strong> = People (like teacher, doctor, friend)</li>
                    <li><strong>Place</strong> = Locations (like school, park, home)</li>
                    <li><strong>Thing</strong> = Objects (like book, ball, chair)</li>
                    <li>Use <strong>Hints</strong> if you need help!</li>
                </ul>
            </div>

            <div class="button-container">
                <button class="btn btn-primary" onclick="showDifficultyScreen()">Let's Play! üéÆ</button>
            </div>

            <!-- Teacher Upload Section -->
            <div class="teacher-section">
                <h3>üìÅ Teacher: Upload Custom Nouns</h3>
                <p>Upload a CSV file with your own nouns to customize the game for your class!</p>
                <div class="upload-area">
                    <div class="upload-buttons">
                        <div class="file-input-wrapper">
                            <button class="btn-upload">üì§ Upload CSV File</button>
                            <input type="file" id="csv-upload" accept=".csv" onchange="handleCSVUpload(event)">
                        </div>
                        <button class="btn-template" onclick="downloadTemplate()">üì• Download Template</button>
                    </div>
                    <div id="upload-status" class="upload-status"></div>
                    <div id="custom-words-badge" class="custom-words-badge">‚úÖ Using Custom Word List</div>
                    <button id="clear-custom-btn" class="btn-clear" onclick="clearCustomWords()" style="display: none;">üóëÔ∏è Clear Custom Words</button>
                </div>
            </div>
        </div>

        <!-- Difficulty Screen -->
        <div id="difficulty-screen" class="screen">
            <h1>Choose Your Level</h1>
            <p class="subtitle">Pick how challenging you want the game to be!</p>

            <div class="difficulty-buttons">
                <button class="difficulty-btn easy" onclick="startGame('easy')">
                    <div>üåü Easy</div>
                    <div class="difficulty-desc">Simple everyday words<br>5 hints available</div>
                </button>
                <button class="difficulty-btn medium" onclick="startGame('medium')">
                    <div>‚≠ê Medium</div>
                    <div class="difficulty-desc">More challenging words<br>3 hints available</div>
                </button>
                <button class="difficulty-btn hard" onclick="startGame('hard')">
                    <div>üåüüåü Hard</div>
                    <div class="difficulty-desc">Tricky words!<br>1 hint available</div>
                </button>
            </div>

            <div class="button-container">
                <button class="btn btn-secondary" onclick="showWelcome()">‚Üê Back</button>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="class-mode">üè´ Classroom Mode - Great for group play!</div>
            
            <div class="game-header">
                <div class="score-display">Score: <span id="score">0</span> / <span id="total">10</span></div>
                <div class="progress-display">Question: <span id="current-question">1</span> / 10</div>
                <div class="hints-display">Hints: <span id="hints-remaining">3</span></div>
            </div>

            <div class="categories-container">
                <div class="category-box person" id="person-box" ondrop="drop(event, 'person')" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                    <div class="category-icon">üë§</div>
                    <div class="category-title">PERSON</div>
                    <div class="dropped-words" id="person-dropped"></div>
                </div>
                <div class="category-box place" id="place-box" ondrop="drop(event, 'place')" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                    <div class="category-icon">üè†</div>
                    <div class="category-title">PLACE</div>
                    <div class="dropped-words" id="place-dropped"></div>
                </div>
                <div class="category-box thing" id="thing-box" ondrop="drop(event, 'thing')" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                    <div class="category-icon">üì¶</div>
                    <div class="category-title">THING</div>
                    <div class="dropped-words" id="thing-dropped"></div>
                </div>
            </div>

            <div id="hint-box" class="hint-box"></div>
            
            <div id="feedback" class="feedback"></div>

            <div class="words-container" id="words-container"></div>

            <div class="button-container">
                <button class="btn btn-hint" id="hint-btn" onclick="showHint()">üí° Get a Hint</button>
                <button class="btn btn-secondary" onclick="showDifficultyScreen()">üîÑ New Game</button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="screen">
            <div class="results-container">
                <h1>üéâ Great Job!</h1>
                <div class="stars" id="stars"></div>
                <div class="final-score">You got <span id="final-score">0</span> out of 10!</div>
                <div class="score-message" id="score-message"></div>
                
                <div class="button-container">
                    <button class="btn btn-primary" onclick="showDifficultyScreen()">Play Again! üéÆ</button>
                    <button class="btn btn-secondary" onclick="showWelcome()">üè† Home</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Custom words uploaded by teacher (null means use defaults)
        let customWords = null;

        // CSV Template with different nouns than the defaults
        const csvTemplateContent = `word,category,hint
captain,person,The leader of a ship or sports team
nurse,person,This person helps doctors care for patients
wizard,person,A magical person with special powers
queen,person,A female ruler of a kingdom
ranger,person,This person protects forests and parks
castle,place,A large stone building where royalty lives
jungle,place,A dense tropical forest with many animals
volcano,place,A mountain that can erupt with lava
island,place,Land completely surrounded by water
canyon,place,A deep valley with steep sides
treasure,thing,Valuable items like gold and jewels
compass,thing,A tool that shows which direction is north
helmet,thing,Protective gear worn on your head
lantern,thing,A portable light you can carry
anchor,thing,Heavy object that keeps a ship in place`;

        // Word banks by difficulty
        const wordBanks = {
            easy: {
                person: [
                    { word: 'teacher', hint: 'This person helps you learn at school' },
                    { word: 'mom', hint: 'A parent who is female' },
                    { word: 'dad', hint: 'A parent who is male' },
                    { word: 'doctor', hint: 'This person helps you when you are sick' },
                    { word: 'friend', hint: 'Someone you like to play with' },
                    { word: 'baby', hint: 'A very young person' },
                    { word: 'grandma', hint: 'Your parent\'s mother' },
                    { word: 'farmer', hint: 'This person grows food' },
                    { word: 'chef', hint: 'This person cooks food' },
                    { word: 'pilot', hint: 'This person flies airplanes' }
                ],
                place: [
                    { word: 'school', hint: 'You go here to learn' },
                    { word: 'park', hint: 'A place with swings and slides' },
                    { word: 'home', hint: 'Where you live with your family' },
                    { word: 'store', hint: 'Where you buy things' },
                    { word: 'beach', hint: 'A sandy place by the water' },
                    { word: 'zoo', hint: 'A place to see animals' },
                    { word: 'library', hint: 'A quiet place with many books' },
                    { word: 'hospital', hint: 'Where sick people get help' },
                    { word: 'farm', hint: 'Where animals and crops are raised' },
                    { word: 'church', hint: 'A place where people pray' }
                ],
                thing: [
                    { word: 'book', hint: 'You read this' },
                    { word: 'ball', hint: 'You can throw or kick this' },
                    { word: 'chair', hint: 'You sit on this' },
                    { word: 'apple', hint: 'A red or green fruit' },
                    { word: 'pencil', hint: 'You write with this' },
                    { word: 'car', hint: 'A vehicle with four wheels' },
                    { word: 'bed', hint: 'You sleep on this' },
                    { word: 'cup', hint: 'You drink from this' },
                    { word: 'shoe', hint: 'You wear this on your foot' },
                    { word: 'phone', hint: 'You use this to call people' }
                ]
            },
            medium: {
                person: [
                    { word: 'athlete', hint: 'Someone who plays sports' },
                    { word: 'musician', hint: 'This person plays music' },
                    { word: 'scientist', hint: 'This person studies and experiments' },
                    { word: 'neighbor', hint: 'Someone who lives near you' },
                    { word: 'artist', hint: 'This person creates art' },
                    { word: 'student', hint: 'Someone who learns at school' },
                    { word: 'principal', hint: 'The leader of a school' },
                    { word: 'firefighter', hint: 'This person puts out fires' },
                    { word: 'dentist', hint: 'This person checks your teeth' },
                    { word: 'author', hint: 'This person writes books' }
                ],
                place: [
                    { word: 'museum', hint: 'A place to see art and history' },
                    { word: 'restaurant', hint: 'Where people eat meals' },
                    { word: 'airport', hint: 'Where airplanes take off' },
                    { word: 'theater', hint: 'Where you watch movies or plays' },
                    { word: 'stadium', hint: 'A big place for sports games' },
                    { word: 'bakery', hint: 'Where bread and cakes are made' },
                    { word: 'aquarium', hint: 'A place to see fish and sea animals' },
                    { word: 'office', hint: 'Where adults go to work' },
                    { word: 'classroom', hint: 'A room where students learn' },
                    { word: 'garden', hint: 'A place where flowers grow' }
                ],
                thing: [
                    { word: 'computer', hint: 'An electronic device for work and games' },
                    { word: 'bicycle', hint: 'A vehicle with two wheels you pedal' },
                    { word: 'umbrella', hint: 'Keeps you dry in the rain' },
                    { word: 'backpack', hint: 'You carry books in this' },
                    { word: 'television', hint: 'You watch shows on this' },
                    { word: 'sandwich', hint: 'Food between two slices of bread' },
                    { word: 'camera', hint: 'You take pictures with this' },
                    { word: 'blanket', hint: 'Keeps you warm in bed' },
                    { word: 'scissors', hint: 'You cut paper with these' },
                    { word: 'flashlight', hint: 'Makes light in the dark' }
                ]
            },
            hard: {
                person: [
                    { word: 'veterinarian', hint: 'A doctor for animals' },
                    { word: 'architect', hint: 'This person designs buildings' },
                    { word: 'astronaut', hint: 'This person travels to space' },
                    { word: 'photographer', hint: 'This person takes pictures' },
                    { word: 'librarian', hint: 'This person works with books' },
                    { word: 'mechanic', hint: 'This person fixes cars' },
                    { word: 'journalist', hint: 'This person writes news stories' },
                    { word: 'electrician', hint: 'This person works with wires and power' },
                    { word: 'archaeologist', hint: 'This person digs up old things' },
                    { word: 'pharmacist', hint: 'This person gives out medicine' }
                ],
                place: [
                    { word: 'laboratory', hint: 'Where scientists do experiments' },
                    { word: 'observatory', hint: 'Where people study stars' },
                    { word: 'gymnasium', hint: 'A big room for exercise and sports' },
                    { word: 'planetarium', hint: 'Shows about space and stars' },
                    { word: 'cafeteria', hint: 'Where students eat lunch at school' },
                    { word: 'sanctuary', hint: 'A safe place for animals' },
                    { word: 'auditorium', hint: 'A large room for performances' },
                    { word: 'warehouse', hint: 'A big building for storing things' },
                    { word: 'peninsula', hint: 'Land surrounded by water on three sides' },
                    { word: 'continent', hint: 'A very large land mass' }
                ],
                thing: [
                    { word: 'microscope', hint: 'Makes tiny things look bigger' },
                    { word: 'telescope', hint: 'Helps you see things far away' },
                    { word: 'thermometer', hint: 'Measures temperature' },
                    { word: 'calculator', hint: 'Helps you do math' },
                    { word: 'encyclopedia', hint: 'A book with lots of information' },
                    { word: 'instrument', hint: 'Something you play to make music' },
                    { word: 'parachute', hint: 'Slows you down when falling' },
                    { word: 'binoculars', hint: 'Two lenses to see far away' },
                    { word: 'stethoscope', hint: 'Doctors use this to hear your heart' },
                    { word: 'photograph', hint: 'A picture taken with a camera' }
                ]
            }
        };

        // Game state
        let currentDifficulty = 'easy';
        let score = 0;
        let currentQuestion = 0;
        let totalQuestions = 10;
        let hintsRemaining = 3;
        let currentWords = [];
        let gameWords = [];
        let currentWordIndex = 0;
        // Hint counts by difficulty
        const hintCounts = {
            easy: 5,
            medium: 3,
            hard: 1
        };

        // Screen navigation
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function showWelcome() {
            showScreen('welcome-screen');
        }

        function showDifficultyScreen() {
            showScreen('difficulty-screen');
        }

        // Start the game
        function startGame(difficulty) {
            currentDifficulty = difficulty;
            score = 0;
            currentQuestion = 0;
            hintsRemaining = hintCounts[difficulty];

            let allWords;

            // Check if custom words are loaded
            if (customWords && customWords.length > 0) {
                // Use custom words (ignore difficulty for custom words)
                allWords = customWords.map(w => ({
                    word: w.word,
                    hint: w.hint,
                    category: w.category
                }));
            } else {
                // Use default word bank
                const bank = wordBanks[difficulty];

                // Select words from all categories
                allWords = [
                    ...bank.person.map(w => ({ ...w, category: 'person' })),
                    ...bank.place.map(w => ({ ...w, category: 'place' })),
                    ...bank.thing.map(w => ({ ...w, category: 'thing' }))
                ];
            }

            // Shuffle and pick up to 10 words
            const availableWords = shuffleArray(allWords);
            gameWords = availableWords.slice(0, Math.min(10, availableWords.length));

            // Update total questions based on available words
            totalQuestions = gameWords.length;
            currentWordIndex = 0;

            updateGameDisplay();
            showScreen('game-screen');
            displayCurrentWord();
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function updateGameDisplay() {
            document.getElementById('score').textContent = score;
            document.getElementById('total').textContent = totalQuestions;
            document.getElementById('current-question').textContent = currentQuestion + 1;
            document.getElementById('hints-remaining').textContent = hintsRemaining;
            document.getElementById('hint-btn').disabled = hintsRemaining <= 0;
            
            // Clear dropped words
            document.getElementById('person-dropped').innerHTML = '';
            document.getElementById('place-dropped').innerHTML = '';
            document.getElementById('thing-dropped').innerHTML = '';
            
            // Hide hint and feedback
            document.getElementById('hint-box').classList.remove('show');
            document.getElementById('feedback').classList.remove('show');
        }

        function displayCurrentWord() {
            const container = document.getElementById('words-container');
            container.innerHTML = '';
            
            if (currentWordIndex >= gameWords.length) {
                showResults();
                return;
            }
            
            const wordData = gameWords[currentWordIndex];
            const card = document.createElement('div');
            card.className = 'word-card';
            card.draggable = true;
            card.textContent = wordData.word;
            card.dataset.word = wordData.word;
            card.dataset.category = wordData.category;
            card.dataset.hint = wordData.hint;
            
            card.addEventListener('dragstart', dragStart);
            card.addEventListener('dragend', dragEnd);
            
            // Touch support for mobile/tablets
            card.addEventListener('touchstart', handleTouchStart, { passive: false });
            card.addEventListener('touchmove', handleTouchMove, { passive: false });
            card.addEventListener('touchend', handleTouchEnd);
            
            container.appendChild(card);
        }

        // Drag and drop functions
        function dragStart(e) {
            e.target.classList.add('dragging');
            e.dataTransfer.setData('text/plain', JSON.stringify({
                word: e.target.dataset.word,
                category: e.target.dataset.category
            }));
        }

        function dragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function allowDrop(e) {
            e.preventDefault();
            e.target.closest('.category-box').classList.add('drag-over');
        }

        function dragLeave(e) {
            e.target.closest('.category-box').classList.remove('drag-over');
        }

        function drop(e, targetCategory) {
            e.preventDefault();
            const box = e.target.closest('.category-box');
            box.classList.remove('drag-over');
            
            try {
                const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                checkAnswer(data.word, data.category, targetCategory);
            } catch (err) {
                console.error('Drop error:', err);
            }
        }

        // Touch handling for mobile
        let touchedCard = null;
        let touchStartX, touchStartY;

        function handleTouchStart(e) {
            touchedCard = e.target;
            touchedCard.classList.add('dragging');
            const touch = e.touches[0];
            touchStartX = touch.clientX;
            touchStartY = touch.clientY;
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (!touchedCard) return;
            
            const touch = e.touches[0];
            touchedCard.style.position = 'fixed';
            touchedCard.style.left = (touch.clientX - 50) + 'px';
            touchedCard.style.top = (touch.clientY - 25) + 'px';
            touchedCard.style.zIndex = 1000;
        }

        function handleTouchEnd(e) {
            if (!touchedCard) return;
            
            const touch = e.changedTouches[0];
            const dropTarget = document.elementFromPoint(touch.clientX, touch.clientY);
            
            touchedCard.classList.remove('dragging');
            touchedCard.style.position = '';
            touchedCard.style.left = '';
            touchedCard.style.top = '';
            touchedCard.style.zIndex = '';
            
            if (dropTarget) {
                const box = dropTarget.closest('.category-box');
                if (box) {
                    const targetCategory = box.id.replace('-box', '');
                    checkAnswer(touchedCard.dataset.word, touchedCard.dataset.category, targetCategory);
                }
            }
            
            touchedCard = null;
        }

        function checkAnswer(word, correctCategory, selectedCategory) {
            const feedback = document.getElementById('feedback');
            const card = document.querySelector('.word-card');
            
            // Hide hint when answer is given
            document.getElementById('hint-box').classList.remove('show');
            
            if (correctCategory === selectedCategory) {
                score++;
                card.classList.add('correct');
                feedback.textContent = '‚úÖ Correct! Great job!';
                feedback.className = 'feedback show correct';
                
                // Add to dropped words display
                const droppedContainer = document.getElementById(selectedCategory + '-dropped');
                const droppedWord = document.createElement('span');
                droppedWord.className = 'dropped-word';
                droppedWord.textContent = word;
                droppedContainer.appendChild(droppedWord);
            } else {
                card.classList.add('incorrect');
                feedback.textContent = `‚ùå Not quite! "${word}" is a ${correctCategory.toUpperCase()}`;
                feedback.className = 'feedback show incorrect';
            }
            
            currentQuestion++;
            currentWordIndex++;
            
            document.getElementById('score').textContent = score;
            document.getElementById('current-question').textContent = Math.min(currentQuestion + 1, totalQuestions);
            
            // Move to next word after delay
            setTimeout(() => {
                feedback.classList.remove('show');
                if (currentWordIndex < gameWords.length) {
                    displayCurrentWord();
                } else {
                    showResults();
                }
            }, 1500);
        }

        function showHint() {
            if (hintsRemaining <= 0) return;
            
            hintsRemaining--;
            document.getElementById('hints-remaining').textContent = hintsRemaining;
            document.getElementById('hint-btn').disabled = hintsRemaining <= 0;
            
            const currentWord = gameWords[currentWordIndex];
            const hintBox = document.getElementById('hint-box');
            hintBox.textContent = 'üí° Hint: ' + currentWord.hint;
            hintBox.classList.add('show');
        }

        function showResults() {
            showScreen('results-screen');
            
            document.getElementById('final-score').textContent = score;
            
            // Calculate stars
            const percentage = (score / totalQuestions) * 100;
            let stars = '';
            let message = '';
            
            if (percentage >= 90) {
                stars = '‚≠ê‚≠ê‚≠ê';
                message = 'Amazing! You\'re a Noun Master!';
            } else if (percentage >= 70) {
                stars = '‚≠ê‚≠ê';
                message = 'Great work! Keep practicing!';
            } else if (percentage >= 50) {
                stars = '‚≠ê';
                message = 'Good effort! Try again to improve!';
            } else {
                stars = 'üåü';
                message = 'Keep learning! You\'ll get better!';
            }
            
            document.getElementById('stars').textContent = stars;
            document.getElementById('score-message').textContent = message;
        }

        // CSV Upload Functions
        function handleCSVUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const statusEl = document.getElementById('upload-status');
            const reader = new FileReader();

            reader.onload = function(e) {
                try {
                    const csvText = e.target.result;
                    const parsed = parseCSV(csvText);

                    if (parsed.errors.length > 0) {
                        showUploadStatus('error', '‚ùå Error: ' + parsed.errors.join(', '));
                        return;
                    }

                    if (parsed.words.length < 3) {
                        showUploadStatus('error', '‚ùå Please include at least 3 words in your CSV.');
                        return;
                    }

                    // Validate categories
                    const validCategories = ['person', 'place', 'thing'];
                    const invalidCategories = parsed.words.filter(w => !validCategories.includes(w.category.toLowerCase()));
                    if (invalidCategories.length > 0) {
                        showUploadStatus('error', '‚ùå Invalid category found. Use only: person, place, thing');
                        return;
                    }

                    // Store custom words
                    customWords = parsed.words.map(w => ({
                        word: w.word.trim(),
                        category: w.category.toLowerCase().trim(),
                        hint: w.hint.trim()
                    }));

                    showUploadStatus('success', `‚úÖ Loaded ${customWords.length} custom words!`);
                    document.getElementById('custom-words-badge').classList.add('show');
                    document.getElementById('clear-custom-btn').style.display = 'inline-block';

                } catch (err) {
                    showUploadStatus('error', '‚ùå Error reading file: ' + err.message);
                }
            };

            reader.onerror = function() {
                showUploadStatus('error', '‚ùå Error reading file');
            };

            reader.readAsText(file);
        }

        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const words = [];
            const errors = [];

            if (lines.length < 2) {
                errors.push('CSV must have a header row and at least one data row');
                return { words, errors };
            }

            // Parse header
            const header = lines[0].toLowerCase().split(',').map(h => h.trim());
            const wordIdx = header.indexOf('word');
            const categoryIdx = header.indexOf('category');
            const hintIdx = header.indexOf('hint');

            if (wordIdx === -1 || categoryIdx === -1 || hintIdx === -1) {
                errors.push('CSV must have columns: word, category, hint');
                return { words, errors };
            }

            // Parse data rows
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                // Handle quoted values with commas
                const values = parseCSVLine(line);

                if (values.length < 3) {
                    errors.push(`Row ${i + 1}: Not enough columns`);
                    continue;
                }

                const word = values[wordIdx]?.trim();
                const category = values[categoryIdx]?.trim().toLowerCase();
                const hint = values[hintIdx]?.trim();

                if (!word || !category || !hint) {
                    errors.push(`Row ${i + 1}: Missing required field`);
                    continue;
                }

                words.push({ word, category, hint });
            }

            return { words, errors };
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;

            for (let i = 0; i < line.length; i++) {
                const char = line[i];

                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            return result;
        }

        function showUploadStatus(type, message) {
            const statusEl = document.getElementById('upload-status');
            statusEl.className = 'upload-status ' + type;
            statusEl.textContent = message;
        }

        function clearCustomWords() {
            customWords = null;
            document.getElementById('upload-status').className = 'upload-status';
            document.getElementById('custom-words-badge').classList.remove('show');
            document.getElementById('clear-custom-btn').style.display = 'none';
            document.getElementById('csv-upload').value = '';
        }

        function downloadTemplate() {
            const blob = new Blob([csvTemplateContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'noun-game-template.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
